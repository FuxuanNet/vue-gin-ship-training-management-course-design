# auth 模块接口文档

## 1. 认证相关接口

### 1.1 用户登录

#### 接口名称

用户登录接口

#### 接口路径

```txt
POST /api/auth/login
```

#### 请求方式

POST

#### 输入参数

```json
{
  "username": "string",  // 必填，用户名，对应 account.login_name
  "password": "string"   // 必填，密码明文（传输时应使用 HTTPS）
}
```

**参数说明：**

| 参数名 | 类型 | 必填 | 说明 | 数据库字段 |
|--------|------|------|------|-----------|
| username | string | 是 | 用户名，长度1-20字符 | account.login_name |
| password | string | 是 | 密码，长度6-20字符 | 需与 account.password_hash 验证 |

#### 返回值

**成功响应（200）：**

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",  // JWT Token
    "user": {
      "id": 1001,                    // person.person_id
      "name": "张三",                 // person.name
      "role": "employee",             // person.role 映射后的英文角色
      "roleDisplay": "员工",          // person.role 原始中文角色
      "accountId": 2001               // account.account_id
    }
  }
}
```

**失败响应（401）：**

```json
{
  "code": 401,
  "message": "用户名或密码错误",
  "data": null
}
```

**其他错误响应（400）：**

```json
{
  "code": 400,
  "message": "参数错误：用户名不能为空",
  "data": null
}
```

---

### 1.2 用户注册

#### 接口名称

用户注册接口

#### 接口路径

```txt
POST /api/auth/register
```

#### 请求方式
POST

#### 输入参数

```json
{
  "username": "string",    // 必填，用户名，对应 account.login_name
  "password": "string",    // 必填，密码明文
  "name": "string",        // 必填，真实姓名，对应 person.name
  "role": "string"         // 必填，角色：employee/teacher/planner
}
```

**参数说明：**

| 参数名 | 类型 | 必填 | 说明 | 数据库字段 |
|--------|------|------|------|-----------|
| username | string | 是 | 用户名，长度3-20字符，仅字母数字下划线 | account.login_name |
| password | string | 是 | 密码，长度6-20字符 | account.password_hash（加密后存储） |
| name | string | 是 | 真实姓名，长度2-20字符 | person.name |
| role | string | 是 | 角色：employee（员工）/ teacher（讲师）/ planner（课程大纲制定者） | person.role（存储为中文） |

#### 返回值

**成功响应（200）：**

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "personId": 1001,        // person.person_id
    "accountId": 2001,       // account.account_id
    "username": "zhangsan",  // account.login_name
    "name": "张三",          // person.name
    "role": "employee",      // 角色英文
    "roleDisplay": "员工"    // 角色中文
  }
}
```

**失败响应（400）：**

```json
{
  "code": 400,
  "message": "用户名已被使用",
  "data": null
}
```

**其他错误示例：**

```json
{
  "code": 400,
  "message": "密码长度必须在6-20位之间",
  "data": null
}
```

---

### 1.3 退出登录

#### 接口名称

退出登录接口

#### 接口路径

```
POST /api/auth/logout
```

#### 请求方式

POST

#### 输入参数

**请求头：**

```txt
Authorization: Bearer <token>
```

**请求体：**
```json
{}  // 空对象，或不传
```

#### 返回值

**成功响应（200）：**
```json
{
  "code": 200,
  "message": "退出成功",
  "data": null
}
```

**未登录响应（401）：**

```json
{
  "code": 401,
  "message": "未登录或登录已过期",
  "data": null
}
```

---

### 1.4 获取当前用户信息

#### 接口名称

获取当前用户信息接口

#### 接口路径

```txt
GET /api/auth/current-user
```

#### 请求方式

GET

#### 输入参数

**请求头：**

```txt
Authorization: Bearer <token>
```

**查询参数：** 无

#### 返回值

**成功响应（200）：**

**员工角色：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "personId": 1001,              // person.person_id
    "name": "张三",                 // person.name
    "role": "employee",             // 角色英文
    "roleDisplay": "员工",          // person.role
    "accountId": 2001,              // account.account_id
    "username": "zhangsan",         // account.login_name
    "statistics": {
      "trainingPlanCount": 2,       // 参与的培训计划数量
      "completedCourseCount": 15,   // 已完成的课程数量
      "totalCourseCount": 20,       // 总课程数量
      "averageScore": 87.5          // 平均得分
    }
  }
}
```

**讲师角色：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "personId": 1002,              // person.person_id
    "name": "李老师",               // person.name
    "role": "teacher",              // 角色英文
    "roleDisplay": "讲师",          // person.role
    "accountId": 2002,              // account.account_id
    "username": "liteacher",        // account.login_name
    "statistics": {
      "courseCount": 5,              // 主讲的课程数量
      "classCount": 32,              // 授课次数（course_item 中的记录数）
      "studentCount": 45,            // 教授的学员总数（去重）
      "averageTeachingScore": 92.3   // 平均教学评分
    }
  }
}
```

**课程大纲制定者角色：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "personId": 1003,              // person.person_id
    "name": "王主管",               // person.name
    "role": "planner",              // 角色英文
    "roleDisplay": "课程大纲制定者", // person.role
    "accountId": 2003,              // account.account_id
    "username": "wangplanner",      // account.login_name
    "statistics": {
      "planCount": 6,                // 创建的培训计划数量
      "totalCourseCount": 28,        // 所有培训计划中的课程总数
      "totalStudentCount": 120,      // 所有培训计划中的学员总数
      "averagePlanScore": 88.7       // 所有培训计划的平均得分
    }
  }
}
```

**未登录响应（401）：**

```json
{
  "code": 401,
  "message": "未登录或登录已过期",
  "data": null
}
```

**用户不存在响应（404）：**
```json
{
  "code": 404,
  "message": "用户不存在",
  "data": null
}
```

---
