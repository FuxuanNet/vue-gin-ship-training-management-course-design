## 2. 主页相关接口

### 2.1 获取平台统计数据

#### 接口名称

获取平台统计数据接口

#### 逻辑描述

1. 前端请求平台整体统计数据（用于主页展示）
2. 后端查询并统计：
   - **培训课程数**：统计 `course` 表的总记录数
   - **讲师团队数**：统计 `person` 表中 `role='讲师'` 的记录数
   - **培训计划数**：统计 `training_plan` 表的总记录数
   - **平均满意度**：
     - 查询 `attendance_evaluation` 表中所有的加权得分（self_score * (1 - score_ratio) + teacher_score * score_ratio）
     - 计算平均值并转换为百分比
3. 如果用户已登录，根据用户角色返回个性化统计：
   - **员工**：返回该员工相关的统计
   - **讲师**：返回该讲师相关的统计
   - **课程大纲制定者**：返回全局统计
4. 如果用户未登录，返回全局统计数据
5. 异常情况：
   - 数据库查询失败：返回默认值或缓存数据

#### 接口路径

```txt
GET /api/home/statistics
```

#### 请求方式

GET

#### 输入参数

**请求头（可选）：**
```
Authorization: Bearer <token>  // 如果已登录则传递
```

**查询参数：** 无

#### 返回值

**未登录或课程大纲制定者角色（全局统计）成功响应（200）：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "courseCount": 28,              // course 表总记录数
    "teacherCount": 12,             // person 表中 role='讲师' 的记录数
    "planCount": 6,                 // training_plan 表总记录数
    "averageSatisfaction": 96,      // 平均满意度百分比（计算自 attendance_evaluation）
    "totalStudentCount": 120,       // person 表中 role='员工' 的记录数
    "totalClassCount": 156,         // plan_course_item 表总记录数（总课次）
    "ongoingPlanCount": 3,          // training_plan 中 plan_status='进行中' 的记录数
    "completedPlanCount": 2         // training_plan 中 plan_status='已完成' 的记录数
  }
}
```

**员工角色（个性化统计）成功响应（200）：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "courseCount": 28,              // 全局课程数
    "teacherCount": 12,             // 全局讲师数
    "planCount": 6,                 // 全局计划数
    "averageSatisfaction": 96,      // 全局平均满意度
    "personalStats": {
      "myPlanCount": 2,             // 该员工参与的计划数（plan_employee）
      "myTotalCourseCount": 20,     // 该员工需要上的总课程数
      "myCompletedCourseCount": 15, // 该员工已完成的课程数（attendance_evaluation 中有评分的）
      "myAverageScore": 87.5,       // 该员工的平均得分
      "myTodayCourseCount": 2,      // 该员工今日课程数
      "myWeekCourseCount": 8        // 该员工本周课程数
    }
  }
}
```

**讲师角色（个性化统计）成功响应（200）：**

```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "courseCount": 28,              // 全局课程数
    "teacherCount": 12,             // 全局讲师数
    "planCount": 6,                 // 全局计划数
    "averageSatisfaction": 96,      // 全局平均满意度
    "personalStats": {
      "myCourseCount": 5,           // 该讲师主讲的课程数（course.teacher_id）
      "myClassCount": 32,           // 该讲师的授课次数
      "myStudentCount": 45,         // 该讲师教授的学员总数（去重）
      "myAverageTeachingScore": 92.3, // 该讲师的平均教学评分
      "myTodayClassCount": 3,       // 该讲师今日授课数
      "myWeekClassCount": 12        // 该讲师本周授课数
    }
  }
}
```

**错误响应（500）：**

```json
{
  "code": 500,
  "message": "服务器内部错误",
  "data": null
}
```
