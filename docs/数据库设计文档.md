## E-R 图

暂时无法在飞书文档外展示此内容

### 实体

#### 培训计划

属性：

- 计划 ID
- 计划名称
- 计划状态
- 计划开始时间
- 计划结束时间
- 指定人所属人员 ID

#### 培训课程安排

属性：

- 安排 ID
- 所属计划 ID
- 上课日期
- 课程开始时间
- 课程结束时间
- 对应课程 ID
- 上课地点

#### 培训课程

属性：

- 课程 ID
- 课程名称
- 课程描述
- 课程要求
- 课程类型
- 主讲人对应人员 ID

#### 人员

属性：

- 人员 ID
- 账号 ID
- 姓名
- 角色

#### 账号

属性：

- 账号 ID
- 人员 ID
- 用户名
- 密码哈希

### 关系

#### 拥有

人员 拥有 账号：1 对 1

#### 包含

培训计划 包含 培训课程安排：1 对 n

#### 安排

培训课程安排 安排 培训课程：n 对 1

#### 参与和评价

人员（角色="员工"） 参与和评价 培训课程安排：m 对 n

属性

- 所属安排 ID
- 所属人员 ID（角色="员工"）
- 自评分数
- 自评内容
- 讲师评分
- 讲师评语

* 讲师评分构成占比

#### 制定

人员（角色="课程大纲指定者"） 指定 培训计划：1 对 n

#### 规划

人员（角色="员工"） 被规划 培训计划：m 对 n

#### 讲授

人员（角色="讲师"） 讲授 培训课程：1 对 n

## 表结构

### 培训计划表：training_plan

| 字段名              | 数据类型    | 主/外键 | 备注                               |
| ------------------- | ----------- | ------- | ---------------------------------- |
| plan_id             | BIGINT      | 主键    | 计划 ID                            |
| plan_name           | VARCHAR(50) | -       | 计划名称                           |
| plan_status         | CHAR(3)     | -       | 计划状态：规划中/进行中/已完成     |
| plan_start_datetime | DATETIME    | -       | 计划开始时间                       |
| plan_end_datetime   | DATETIME    | -       | 计划结束时间                       |
| creator_id          | BIGINT      | 外键    | 制定人（人员ID，表示“制定”关系） |

### 规划员工表：plan_employee

| 字段名                                 | 数据类型 | 主/外键  | 备注    |
| -------------------------------------- | -------- | -------- | ------- |
| plan_id                                | BIGINT   | 主键外键 | 计划 ID |
| person_id                              | BIGINT   | 人员 ID  |         |

### 培训课程表：course

| 字段名         | 数据类型     | 主/外键 | 备注                             |
| -------------- | ------------ | ------- | -------------------------------- |
| course_id      | BIGINT       | 主键    | 课程 ID                          |
| course_name    | VARCHAR(50)  | -       | 课程名称                         |
| course_desc    | VARCHAR(100) | -       | 课程描述                         |
| course_require | VARCHAR(500) | -       | 课程要求                         |
| course_class   | VARCHAR(20)  | -       | 课程类型                         |
| teacher_id     | BIGINT       | 外键    | 主讲讲师（人员ID，“讲授”关系） |

### 人员表：person

| 字段名    | 数据类型    | 主/外键 | 备注                           |
| --------- | ----------- | ------- | ------------------------------ |
| person_id | BIGINT      | 主键    | 人员 ID                        |
| name      | VARCHAR(20) | -       | 姓名                           |
| role      | VARCHAR(7)  | -       | 角色：员工/讲师/课程大纲制定者 |

### 账号表：account

| 字段名        | 数据类型     | 主/外键 | 备注     |
| ------------- | ------------ | ------- | -------- |
| account_id    | BIGINT       | 主键    | 账号 ID  |
| person_id     | BIGINT       | 外键    | 人员 ID  |
| login_name    | VARCHAR(20)  | -       | 用户名   |
| password_hash | VARCHAR(255) | -       | 密码哈希 |

### 培训课程安排表：plan_course_item

| 字段名           | 数据类型     | 主/外键 | 备注                      |
| ---------------- | ------------ | ------- | ------------------------- |
| item_id          | BIGINT       | 主键    | 安排 ID                   |
| plan_id          | BIGINT       | 外键    | 所属计划 ID（"包含"关系） |
| course_id        | BIGINT       | 外键    | 对应课程 ID（"安排"关系） |
| class_date       | DATE         | -       | 上课日期                  |
| class_begin_time | TIME         | -       | 课程开始时间              |
| class_end_time   | TIME         | -       | 课程结束时间              |
| location         | VARCHAR(100) | -       | 上课地点                  |

### 参与和评价表：`attendance_evaluation`

| 字段名          | 数据类型 | 主/外键    | 备注                                     |
| --------------- | -------- | ---------- | ---------------------------------------- |
| person_id       | BIGINT   | 主键，外键 | 人员ID（员工，连到【人员】实体）         |
| item_id         | BIGINT   | 主键，外键 | 培训课程安排ID(连到【培训课程安排】实体) |
| self_score      | FLOAT(2) | -          | 员工自评分（算法生成）                   |
| self_comment    | TEXT     | -          | 自评文本/问卷内容                        |
| teacher_score   | FLOAT(2) | -          | 讲师给该员工的评分                       |
| teacher_comment | TEXT     | -          | 讲师评语                                 |
| score_ratio     | FLOAT(2) | -          | 讲师评分构成占比，由此可计算出员工自评   |

## 视图

> 为什么使用视图？
>
> - 课程、成绩之类是动态更新的，每次都需要重新计算，单独建表的维护成本很高。
> - 如果使用触发器来计算的话，那员工每上完一门课，触发器就要按照重新折合成绩来计算，计算过于频繁，而且对于总体来说是无意义的，因为微小的改动不太影响全局的变化。
> - 所以使用视图，现用现查现计算，结果可以保存到前端缓存，等需要更新的时候再重新向后端发送请求去做计算。

### 员工每节课得分视图：`v_employee_item_score`

**功能说明：**

按“员工 × 课程安排”展示每一节课的详细信息和得分情况，用于：

- 员工个人查看每节课得分情况
- 后续做课程、计划、员工维度的各类统计的基础视图

class_time 来源已发生更改，后续将更改。

course_class 来源有可能也发生更改。

| 字段名           | 来源                                | 备注            |
| ---------------- | ----------------------------------- | --------------- |
| person_id        | attendance_evaluation.person_id     | 员工 ID         |
| person_name      | person.name                         | 员工姓名        |
| item_id          | plan_course_item.item_id            | 课程安排 ID     |
| class_date       | plan_course_item.class_date         | 上课日期        |
| class_begin_time | plan_course_item.class_begin_time   | 上课开始时间    |
| class_end_time   | plan_course_item.class_end_time     | 上课结束时间    |
| location         | plan_course_item.location           | 上课地点        |
| plan_id          | plan_course_item.plan_id            | 所属培训计划 ID |
| plan_name        | training_plan.plan_name             | 培训计划名称    |
| course_id        | plan_course_item.course_id          | 课程 ID         |
| course_name      | course.course_name                  | 课程名称        |
| course_class     | course.course_class                 | 课程类型        |
| self_score       | attendance_evaluation.self_score    | 员工自评分      |
| teacher_score    | attendance_evaluation.teacher_score | 讲师评分        |
| weighted_score   | 由 self_score 和 teacher_score 计算 | 加权得分        |

### 员工 × 课程类型综合得分视图：`v_employee_course_score`

**功能说明：**

按“员工 + 课程类型”维度，汇总该员工在该系列类型的课程下所有上课记录的平均加权得分，用于：

- 分析某员工在哪些课程上薄弱
- 后续做员工×课程类型的雷达图、热力图等可视化

| 字段名             | 来源                               | 备注                           |
| ------------------ | ---------------------------------- | ------------------------------ |
| person_id          | v_employee_item_score.person_id    | 员工 ID                        |
| course_id          | v_employee_item_score.course_class | 课程 ID                        |
| avg_weighted_score | 聚合计算                           | 员工在该类课程上的平均加权得分 |

### 课程整体评分视图：`v_course_score`

**功能说明：**

从“课程”维度汇总所有员工的表现，用于：

- 分析课程整体效果（平均得分）
- 看这门课参与人数，辅助判断课程难度、受欢迎程度等

| 字段名           | 来源                              | 备注                         |
| ---------------- | --------------------------------- | ---------------------------- |
| course_id        | v_employee_item_score.course_id   | 课程 ID                      |
| course_name      | v_employee_item_score.course_name | 课程名称                     |
| course_avg_score | 聚合计算                          | 课程整体平均加权得分         |
| student_count    | 聚合计算                          | 参与该课程的员工人数（去重） |

### 培训计划整体评分视图：`v_plan_score`

**功能说明：**

从“培训计划”维度，综合该计划下所有课程、所有员工的表现，用于：

- 对每个培训计划做整体效果评估
- 做不同培训计划之间的对比分析

| 字段名         | 来源                            | 备注                 |
| -------------- | ------------------------------- | -------------------- |
| plan_id        | v_employee_item_score.plan_id   | 培训计划 ID          |
| plan_name      | v_employee_item_score.plan_name | 培训计划名称         |
| plan_avg_score | 聚合计算                        | 培训计划整体平均得分 |

### 员工课表视图：`v_employee_timetable`

**功能说明：**

面向员工端，展示“员工个人课程表”，包括：

- 每节课的时间、地点、课程名称、课程要求等
- 用于首页“今日课程”、“本周课程”的课表展示

| 字段名           | 来源                              | 备注         |
| ---------------- | --------------------------------- | ------------ |
| person_id        | attendance_evaluation.person_id   | 员工 ID      |
| person_name      | person.name                       | 员工姓名     |
| item_id          | plan_course_item.item_id          | 课程安排 ID  |
| class_date       | plan_course_item.class_date       | 上课日期     |
| class_begin_time | plan_course_item.class_begin_time | 上课开始时间 |
| class_end_time   | plan_course_item.class_end_time   | 上课结束时间 |
| location         | plan_course_item.location         | 上课地点     |
| course_name      | course.course_name                | 课程名称     |
| course_require   | course.course_require             | 课程要求     |

### 讲师课表视图：`v_teacher_timetable`

**功能说明：**

面向讲师端，展示“讲师个人课程表”，包括：

- 每节课的时间、地点、课程名称、课程要求等
- 用于讲师查看自己每日/每周的授课安排

| 字段名           | 来源                                 | 备注         |
| ---------------- | ------------------------------------ | ------------ |
| teacher_id       | course.teacher_id / person.person_id | 讲师 ID      |
| teacher_name     | person.name                          | 讲师姓名     |
| item_id          | plan_course_item.item_id             | 课程安排 ID  |
| class_date       | plan_course_item.class_date          | 上课日期     |
| class_begin_time | plan_course_item.class_begin_time    | 上课开始时间 |
| class_end_time   | plan_course_item.class_end_time      | 上课结束时间 |
| location         | plan_course_item.location            | 上课地点     |
| course_id        | course.course_id                     | 课程 ID      |
| course_name      | course.course_name                   | 课程名称     |
| course_require   | course.course_require                | 课程要求     |
